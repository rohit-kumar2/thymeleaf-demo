<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Products</title>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"/>
</head>
<body ng-app="addProduct" ng-controller="addProductCtrl">
<div class="w-75 mx-auto mt-5 card p-5">
	<h2 class="mb-4 text-uppercase">Add Product</h2>
	<!-- <form id="product-frm" method="post" th:action="@{/product}" th:object="${product}"> -->
	<form id="product-frm" ng-submit="onSubmit()">
		<div class="form-group">
			<label for="name">Product name</label>
			<input class="form-control" type="text" name="name" ng-model="product.name"/><!-- th:field="*{name}" -->
		</div>
		<div class="form-group">
			<label for="price">Price</label>
			<input class="form-control" type="text" name="price" ng-model="product.price"/><!-- th:field="*{price}" -->
		</div>
		<div class="form-check">
			<input type="checkbox" class="form-check-input" name="inStock" ng-model="product.inStock"/><!-- th:field="*{inStock}" -->
			<label class="form-check-label" for="inStock">In stock</label>
		</div>
		<button class="btn btn-dark mt-5 float-right" type="submit" name="submit">Add Product</button>
		<!-- <input class="btn btn-dark mt-5 float-right" type="submit" value="Add Product" /> -->
	</form>
</div>
</body>
<script>
	var app = angular.module("addProduct", [])
		.config(function ($httpProvider, $httpParamSerializerJQLikeProvider){
	    $httpProvider.defaults.transformRequest.unshift($httpParamSerializerJQLikeProvider.$get());
	    $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded; charset=utf-8';
	});
	app.controller("addProductCtrl", function($scope, $http, $window) {
		$scope.onSubmit = function() {
			var onSuccess = function (response) {
	            alert('Product saved successfully.');
	            $window.location.href = '/product/list';
	        };
	
	        var onError = function (response) {
	            alert('Error occured.');
	        };
	        
			$http.post("/product", $scope.product)
				.then(function(response) {
					return response.data;
				}, function(reason) {
					onError(reason)
				})
				.then(function(value) {
					onSuccess(value);
				}, function(reason) {
					onError(reason)
				});
		};
	});
</script>
</html>